<!doctype html>
<html lang="en">
<head>
    <title>The Drought</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="components/bootstrap/dist/css/bootstrap.css">
    
    <link rel="stylesheet" type="text/css" href="components/jquery-ui/themes/ui-lightness/jquery-ui.css">
    <link rel="stylesheet" type="text/css" href="css/drought.css">
    
    <style type="text/css">
    body { padding-top: 100px; }

    #slider { 
        margin-top: .75em; 
        margin-bottom: .75em;
    }

    .year {
        margin-bottom: 1.5em;
    }

    .week {
        display: none;
    }

    .week.active {
        display: block;
    }


    </style>
</head>
<body>
    <header class="navbar navbar-default navbar-fixed-top">
        <div class="row">
            <div class="col-lg-12">
                <h1>The Drought</h1>
                <p>Move the slider to compare drought conditions week by week over the past 14 years.</p>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12 col-md-12">
                <div id="slider"></div>
            </div>
        </div>
    </header>

    <div class="container">
        <div id="maps" class="row"></div>
    </div>

    <script src="js/weeks.js"></script>
    <script src="components/underscore/underscore.js"></script>
    <script src="components/d3/d3.min.js" charset="utf-8"></script>
    <script src="components/jquery/jquery.min.js"></script>
    <script src="components/jquery-ui/ui/jquery-ui.js"></script>

    <script type="text/javascript">
    var IMG_PATH = "img/drought/";
    
    var formats = {
        file: d3.time.format('usdm%y%m%d'),
        date: d3.time.format('%b %d, %Y'),
        week: d3.time.format('%Y-%m-%d'),
    };

    var nest = d3.nest().key(function(d) {
        return formats.file.parse(d).getFullYear();
    }).sortKeys(d3.descending);

    var years = d3.select('#maps').selectAll('.year')
        .data(nest.entries(WEEKS));
    
    years.enter().append('div')
        .attr('class', 'year col-lg-4 col-md-6 col-sm-6 col-xs-12')
        .attr('id', function(d) { return 'year-' + d.key; });

    var weeks = years.selectAll('.week')
        .data(function(d) { return d.values; });
    
    weeks.enter().append('div')
        .classed('week', true)
        .classed('active', function(d, i) { return i === 0; })
      .append('img')
        .attr('src', function(d) { return IMG_PATH + d + '.png'; })
        .classed('img-responsive', true)
    
    weeks.append('h3')
        .text(function(d) {
            return formats.date(formats.file.parse(d));
        });

    var slider = $('#slider').slider({
        max: 51,

        change: function(e, ui) {
            update(e, ui);
        },

        slide: function(e, ui) {
            $('.week-num').text(ui.value + 1);
            update(e, ui);
        }

    });

    function update(e, ui) {
        weeks.classed('active', function(d, i) { return ui.value === i; });
    }

    // bits of setup
    slider.slider({ value: weeks[0].length - 1 });
    $(window).on('resize', function(e) {
        $('body').css('padding-top', $('header').height());        
    }).resize();

    </script>

</body>
</html>